"use strict";angular.module("interDromeApp",["ngCookies","ngResource","ngSanitize","ngRoute","google-maps","ngAutocomplete","btford.socket-io","ui.bootstrap","xeditable","ngGrid"]).factory("idSocket",["socketFactory",function(a){console.log("Creating Socket.io connection factory");var b=a();return b.forward("connected"),b.forward("beacon-info"),b.forward("bleep-enter"),b.forward("bleep-exit"),b.forward("hue-bridges"),b.forward("hue-bridge-registration-complete"),b.forward("hue-bridge-get-lights"),b.forward("hue-bridge-lights"),b.forward("wemo-discovery"),b.forward("wemo-found"),b.forward("wemo-set-binary-state-result"),b.forward("xbee"),b}]).config(["$routeProvider","$locationProvider","$httpProvider",function(a,b,c){a.when("/",{templateUrl:"partials/interzone",controller:"InterZoneCtrl",authenticate:!0}).when("/login",{templateUrl:"partials/login",controller:"LoginCtrl"}).when("/adduser",{templateUrl:"partials/adduser",controller:"AddUserCtrl"}).when("/settings",{templateUrl:"partials/settings",controller:"SettingsCtrl",authenticate:!0}).when("/interzone",{templateUrl:"partials/interzone",controller:"InterZoneCtrl",authenticate:!0}).when("/controls",{templateUrl:"partials/controls",controller:"ControlCtrl",authenticate:!0}).when("/bleeps",{templateUrl:"partials/bleep",controller:"BleepCtrl",authenticate:!0}).when("/events",{templateUrl:"partials/events",controller:"EventCtrl",authenticate:!0}).when("/notifications",{templateUrl:"partials/notifications",controller:"NotificationCtrl",authenticate:!0}).otherwise({redirectTo:"/interzone"}),b.html5Mode(!0),c.interceptors.push(["$q","$location",function(a,b){return{responseError:function(c){return 401===c.status?(b.path("/login"),a.reject(c)):a.reject(c)}}}])}]).run(["$rootScope","$location","Auth","editableOptions",function(a,b,c,d){d.theme="bs3",a.$on("$routeChangeStart",function(a,d){$(".popover").css("display","none"),d.authenticate&&!c.isLoggedIn()&&b.path("/login")})}]),String.prototype.capitalize=function(){return this.charAt(0).toUpperCase()+this.slice(1)},angular.module("interDromeApp").controller("MainCtrl",["$scope","idSocket",function(a){function b(){var a=new Kinetic.Layer,b=new Image;b.onload=function(){var d=new Kinetic.Image({x:0,y:0,image:b,width:480,height:524});a.add(d),c.add(a)},b.src="images/floorplan.jpg"}a.$on("socket:connected",function(){console.log("Connected")}),a.$on("socket:bleep-enter",function(a,b){console.log("BLEEP Enter "+JSON.stringify(b))}),a.$on("socket:bleep-exit",function(a,b){console.log("BLEEP Exit "+JSON.stringify(b))});var c=new Kinetic.Stage({container:"container",width:480,height:524}),d=0;a.add_bleep=function(){var a=new Kinetic.Layer,b=new Image;b.onload=function(){var e=new Kinetic.Image({x:0,y:0,image:b,width:30,height:26,draggable:!0});a.add(e),c.add(a),d+=1;var f=d;e.on("dragend",function(){console.log("dragend. bleep id "+f+". New x:"+e.x()+", new y:"+e.y())})},b.src="images/tetraeder.gif"},b()}]),angular.module("interDromeApp").controller("NavbarCtrl",["$scope","$location","Auth",function(a,b,c){a.menu=[{title:"Inter.'.Zones",link:"/interzone"},{title:"Bleeps",link:"/bleeps"},{title:"Events",link:"/events"},{title:"Controls",link:"/controls"},{title:"Notifications",link:"/notifications"},{title:"Settings",link:"/settings"}],a.logout=function(){c.logout().then(function(){b.path("/login")})},a.isActive=function(a){return a===b.path()}}]),angular.module("interDromeApp").controller("LoginCtrl",["$scope","Auth","$location",function(a,b,c){a.user={},a.errors={},a.login=function(d){a.submitted=!0,d.$valid&&b.login({email:a.user.email,password:a.user.password}).then(function(){c.path("/interzone")}).catch(function(b){b=b.data,a.errors.other=b.message})}}]),angular.module("interDromeApp").controller("AddUserCtrl",["$scope","Auth","$location",function(a,b,c){a.user={},a.errors={},a.register=function(d){a.submitted=!0,d.$valid&&b.createUser({name:a.user.name,email:a.user.email,password:a.user.password}).then(function(){c.path("/")}).catch(function(b){b=b.data,a.errors={},angular.forEach(b.errors,function(b,c){d[c].$setValidity("mongoose",!1),a.errors[c]=b.message})})}}]),angular.module("interDromeApp").controller("SettingsCtrl",["$scope","User","Auth",function(a,b,c){a.errors={},a.changePassword=function(b){a.submitted=!0,b.$valid&&c.changePassword(a.user.oldPassword,a.user.newPassword).then(function(){a.message="Password successfully changed."}).catch(function(){b.password.$setValidity("mongoose",!1),a.errors.other="Incorrect password"})}}]),angular.module("interDromeApp").controller("InterZoneCtrl",["$scope","$rootScope","$http","idSocket","InterZone","BootstrapGrowl","Bleep",function(a,b,c,d,e,f,g){function h(){a.interZone={name:"",loc:{latitude:37.7749295,longitude:-122.41941550000001},points:[],angle:-1,pan:-1,zoom:-1,default_zone:!1,dirty:!1,newInstance:!0}}function i(b,c){e.get(function(d){if(d.interZones.unshift({_id:"",name:""}),a.interZoneData=d,"undefined"!=typeof b){for(var e=0;e<a.interZoneData.interZones.length;e++)if(a.interZoneData.interZones[e].name==b){if(a.interZone=a.interZoneData.interZones[e],"undefined"!==a.interZoneControl.reset)try{a.interZoneControl.reset(a.interZone.points)}catch(f){}return void("undefined"!=typeof c&&c())}}else"undefined"!=typeof c&&c()})}function j(){i(void 0,function(){var b=a.selectDefaultZone();b?a.minimized=!0:(h(),a.interZoneEditInfo=!1,a.newInterZone=!1,a.showMap=!1,a.minimized=!1),a.autocomplete=void 0})}function k(){f.success("InterZone Saved",s),i(a.interZone.name),a.interZone.dirty=!1,a.interZoneEditInfo=!0,a.interZoneView=!0,a.newInterZone=!1}function l(){console.log("InterZone not found. Creating new Zone."),a.interZone.angle=0,a.interZone.pan=[0,0],a.interZone.zoom=1,e.save(a.interZone,function(){console.log("saveInterZone save callback"),k()},function(a){f.error("Error saving InterZone; "+JSON.stringify(a),s)})}function m(b,c){for(var d,f=0;f<a.interZoneData.interZones.length;f++)(b&&a.interZoneData.interZones[f]._id===a.interZone._id||!b&&a.interZoneData.interZones[f]._id!==a.interZone._id)&&a.interZoneData.interZones[f].default_zone&&(d=a.interZoneData.interZones[f]);"undefined"!=typeof d?(d.default_zone=!1,e.update({id:d._id},d,function(){"undefined"!=typeof c&&c()})):c()}function n(a,b){a.default_zone=!0,e.update({id:a._id},a,function(){console.log("favorited "+a.name),a.default_zone=!0,"undefined"!=typeof b&&b()})}function o(b,c){if(console.log("\nBeacon Info"),console.log("BLEEP interzone id "+b.interZone),"undefined"!==b.interZone&&a.interZone._id===b.interZone)for(var d=0;d<a.interZone.bleeps.length;d++)a.interZone.bleeps[d]._id===b._id&&(a.interZone.bleeps[d].bleep=b,a.interZoneControl.beaconInfo(b,c))}function p(b,c){if(console.log("\nBLEEP Enter"),console.log("BLEEP interzone id "+b.interZone),"undefined"!==b.interZone&&a.interZone._id===b.interZone)for(var d=0;d<a.interZone.bleeps.length;d++)a.interZone.bleeps[d]._id===b._id&&(a.interZone.bleeps[d].bleep=b,a.interZoneControl.bleepUpdate(b,c,!0))}function q(b,c){if(console.log("\nBLEEP Exit"),console.log("BLEEP interzone id "+b.interZone),"undefined"!==b.interZone&&a.interZone._id===b.interZone)for(var d=0;d<a.interZone.bleeps.length;d++)a.interZone.bleeps[d]._id===b._id&&(a.interZone.bleeps[d].bleep=b,a.interZoneControl.bleepUpdate(b,c,!1))}a.debug=!1,a.width=1024,a.height=468,a.interZoneEdit=!1,a.interZoneWidth=1024,a.interZoneHeight=468,a.interZoneEditInfo=!1,a.newInterZone=!1,a.showMap=!1,a.interZoneControl={},a.interZoneEditorControl={},a.mapControl={},a.interZonePoints,a.minimized=!0,a.bleepData=g.get(),a.lastView={map:!1,selectedView:!1},a.angle,a.pan,a.zoom;var r={panControl:!0,zoomControl:!0,scaleControl:!0,mapTypeControl:!1,mapTypeId:google.maps.MapTypeId.SATELLITE,tilt:0};a.map={zoom:24,options:r};var s={ele:"#interzone-bootstrap-growl"};a.$on("socket:beacon-info",function(a,b){b.err||o(b.bleep,b.beacon)}),a.$on("socket:bleep-enter",function(a,b){b.err||p(b.bleep,b.beaconAddr)}),a.$on("socket:bleep-exit",function(a,b){b.err||q(b.bleep,b.beaconAddr)}),a.$watch("details.geometry",function(){"undefined"!=typeof a.details&&(a.interZone.loc.latitude=a.details.geometry.location.k,a.interZone.loc.longitude=a.details.geometry.location.A,a.showMap=!0,a.interZoneEditInfo=!0,console.log("autocomplete"+a.autocomplete))},!0),a.$watch("interZone.angle",function(b,c){"undefined"!=typeof a.interZone&&-1!==c&&(a.interZone.dirty=!0)}),a.$watch("interZone.points",function(b,c){"undefined"!=typeof c&&0!==c.length&&(a.interZone.dirty=!0)}),a.$watch("interZone.pan",function(b,c){"undefined"!=typeof c&&-1!==c&&(a.interZone.dirty=!0)}),a.$watch("interZone.zoom",function(b,c){"undefined"!=typeof c&&-1!==c&&(a.interZone.dirty=!0)}),a.createInterZone=function(){a.lastView.map=!0,a.lastView.selectedView=!1,h(),a.newInterZone=!0,a.interZoneEditInfo=!1,a.interZoneView=!1,a.showMap=!1,a.autocomplete=void 0,a.details=void 0,a.interZonePoints=a.interZone.points},a.interZoneSelected=function(){if(a.lastView.map=!1,a.lastView.selectedView=!0,a.newInterZone=!1,a.interZoneEditInfo=!0,a.interZoneEdit=!1,a.showMap=!1,a.interZoneView=!0,a.autocomplete=void 0,a.details=void 0,a.interZonePoints=a.interZone.points,"undefined"!==a.interZoneControl.reset)try{a.interZoneControl.reset(a.interZone.points)}catch(b){}if("undefined"!==a.interZoneEditorControl.reset)try{a.interZoneEditorControl.reset(a.interZone.points)}catch(b){}a.interZone.dirty=!1},a.editInterZone=function(){a.showMap=!0,a.interZoneEdit=!0,a.interZoneView=!1;setTimeout(function(){a.mapControl.refresh(a.interZone.loc),a.map.zoom=24},100)},a.cancelEdit=function(){a.interZoneEdit=!1,a.lastView.map||a.lastView.selectedView&&(a.interZoneEditInfo=!0,a.interZoneView=!0,a.showMap=!1)},a.saveInterZone=function(){if(0===a.interZone.name.length)f.error("Error: InterZone Name Required.",s);else if(0===a.interZone.points.length)f.error("Error: InterZone Floor Plan Required.",s);else if(a.showMap=!1,a.interZoneEdit=!1,"undefined"!=typeof a.interZone._id){e.get({id:a.interZone._id},function(b){console.log("InterZone found with id "+b._id),b.name=a.interZone.name,b.angle=a.interZone.angle,b.pan=a.interZone.pan,b.zoom=a.interZone.zoom,b.default_zone=a.interZone.default_zone,b.points=a.interZone.points,b.bleeps=a.interZone.bleeps,console.log("Updating InterZone to: "+JSON.stringify(b)),b.$update({id:b._id},function(){k()})},function(){l()})}else l()},a.interZoneControl.bleepChange=function(a){console.log("bleep changed. bleep location: "+JSON.stringify(a.location)),g.update({id:a._id},a,function(){console.log("bleep update callback")})},a.clearInterZone=function(){a.interZoneEditorControl.clear()},a.hideMap=function(){a.showMap=!1},a.checkName=function(a){console.log("Checking name "+a)},a.changeFavorite=function(){a.interZone.default_zone?m(!0):m(!1,function(){n(a.interZone)})},a.selectDefaultZone=function(){for(var b=0;b<a.interZoneData.interZones.length;b++)if(a.interZoneData.interZones[b].default_zone)return"undefined"!=typeof a.interZone&&a.interZoneData.interZones[b]._id===a.interZone._id?void 0:(a.interZone=a.interZoneData.interZones[b],a.interZoneSelected(),!0);return!1},a.minMax=function(){a.minimized?(a.minimized=!1,$(".collapse").collapse("show")):(a.minimized=!0,$(".collapse").collapse("hide"))},a.collapseClass=function(b){return a.minimized?b+" collapse":b+" collapse in"},a.minimizeToolTip=function(){return a.minimized?"Click to Maximize":"Click to Minimize"},a.favoriteToolTip=function(){return a.interZone.default_zone?"Click to Reset Favorite":"Click to Favorite"},a.addBleep=function(b){for(var c=0;c<a.interZone.bleeps.length;c++)if(a.interZone.bleeps[c]._id===b._id)return void console.log("BLEEP already in zone.");b.interZone=a.interZone._id,a.interZoneControl.addBleep(b)},a.interZoneControl.ready=function(){a.interZone.newInstance||a.interZoneControl.reset(a.interZone.points)},a.interZoneEditorControl.ready=function(){a.interZone.newInstance||a.interZoneEditorControl.reset(a.interZone.points)};var t;a.beaconSearch=function(b){if(b.length>0){console.log("Beacon Search for "+b);for(var c=!1,d=0;d<a.interZone.bleeps.length;d++)for(var e=0;e<a.interZone.bleeps[d].beacons.length;e++)0===a.interZone.bleeps[d].beacons[e].name.indexOf(b)&&(t={bleep:a.interZone.bleeps[d],beacon:a.interZone.bleeps[d].beacons[e]},a.interZoneControl.selectBeacon(t.beacon,t.bleep),c=!0)}c||"undefined"==typeof t||(a.interZoneControl.resetSelectedBeacon(t.beacon,t.bleep),t=void 0)},j()}]),angular.module("interDromeApp").controller("ControlCtrl",["$scope","idSocket","HueBridge","Wemo","$modal","$log",function(a,b,c,d,e,f){function g(b,d){d.err||(a.hueBridges=c.get(),h.dismiss("cancel"))}var h;a.discoverHueBridgeDisabled=!1,a.discoverWemoDevicesDisabled=!1,a.hueBridges=c.get(),a.wemo,a.$on("socket:hue-bridges",function(b,c){console.log("Hue Bridges Discovered "+JSON.stringify(c)),a.discoverHueBridgeDisabled=!1,a.hueBridges=c}),a.$on("socket:wemo-found",function(b,c){if(console.log("Wemo Device Discovered "+JSON.stringify(c)),"undefined"!=typeof a.wemo&&"undefined"!=typeof a.wemo.devices){for(var d=0;d<a.wemo.devices.length;d++)if(a.wemo.devices[d].ip===c.ip)return console.log("Wemo Already Found"),void(a.discoverWemoDevicesDisabled=!1);a.wemo.devices.push(c),a.$digest()}else a.wemo={devices:[]},a.wemo.devices.push(c),a.$digest();a.discoverWemoDevicesDisabled=!1}),a.discoverHueBridges=function(){console.log("Discovering Hue Bridges"),a.discoverHueBridgeDisabled=!0,b.emit("hue",{action:"discovery"},function(){console.log("emit callback")})},a.openHueBidgeModal=function(a){h=e.open("undefined"==typeof a.user?{templateUrl:"hue-bridge-modal-register-content",controller:HueBridgeRegisterModalInstanceCtrl,resolve:{socket:function(){return b},bridge:function(){return a},registrationComplete:function(){return g}}}:{templateUrl:"hue-bridge-modal-lights-content",controller:HueBridgeLightsModalInstanceCtrl,resolve:{socket:function(){return b},selectedBridge:function(){return a},HueBridge:function(){return c}}}),h.result.then(function(){},function(){f.info("Modal dismissed at: "+new Date)})},a.openWemoDeviceModal=function(a){h=e.open({templateUrl:"wemo-device-content",controller:WemoDeviceModalInstanceCtrl,resolve:{socket:function(){return b},wemoDevice:function(){return a}}}),h.result.then(function(){},function(){f.info("Modal dismissed at: "+new Date)})},a.discoverWemoDevices=function(){console.log("Discovering Wemo Devices"),a.discoverWemoDevicesDisabled=!0,b.emit("wemo",{action:"discovery"},function(){console.log("emit callback")}),setTimeout(function(){a.discoverWemoDevicesDisabled&&(console.log("Re-enabling Wemo Device Search"),a.discoverWemoDevicesDisabled=!1,a.$digest())},1e4)}}]);var HueBridgeRegisterModalInstanceCtrl=["$scope","$modalInstance","socket","bridge","registrationComplete",function(a,b,c,d,e){a.bridge=d,a.registerHueBridgeDisabled=!1,a.alerts=[],a.closeAlert=function(b){a.alerts.splice(b,1)},a.$on("socket:hue-bridge-registration-complete",function(b,c){console.log("Hue Bridge Registration Complete "+JSON.stringify(c)),c.err&&a.alerts.push({type:"danger",msg:"Error: "+c.err.message.capitalize()}),a.registerHueBridgeDisabled=!1,e(b,c)}),a.register=function(){a.alerts=[],a.registerHueBridgeDisabled=!0,c.emit("hue",{action:"register",bridge:d},function(){console.log("emit callback")})},a.cancel=function(){b.dismiss("cancel")}}],HueBridgeLightsModalInstanceCtrl=["$scope","$modalInstance","socket","selectedBridge","HueBridge",function(a,b,c,d,e){a.bridge=d,a.alerts=[],a.hueBridgeName,c.emit("hue",{action:"getLights",bridge:d},function(){console.log("emit callback")}),a.$on("socket:hue-bridge-get-lights",function(b,c){c.err?a.alerts.push({type:"danger",msg:"Error: "+c.err.message.capitalize()}):a.lights=c.lights}),a.$on("socket:hue-bridge-lights",function(b,c){c.err?a.alerts.push({type:"danger",msg:"Error: "+c.err.message.capitalize()}):console.log("Hue Bridge Lights Response "+JSON.stringify(c))}),a.setHueBridgeName=function(b){13==b&&e.update({id:a.bridge._id,name:a.bridge.name})},a.closeAlert=function(b){a.alerts.splice(b,1)},a.turnOn=function(b){a.alerts=[],c.emit("hue",{action:"on",bridge:bridge,light:b},function(){console.log("emit callback")})},a.turnOff=function(b){a.alerts=[],c.emit("hue",{action:"off",bridge:bridge,light:b},function(){console.log("emit callback")})},a.cancel=function(){b.dismiss("cancel")}}],WemoDeviceModalInstanceCtrl=["$scope","$modalInstance","socket","wemoDevice",function(a,b,c,d){a.alerts=[],a.wemoDevice=d,a.$on("socket:wemo-set-binary-state-result",function(b,c){console.log(JSON.stringify(c)),c.err&&a.alerts.push({type:"danger",msg:"Error: "+c.err.code.capitalize()})}),a.closeAlert=function(b){a.alerts.splice(b,1)},a.turnOn=function(){a.alerts=[],c.emit("wemo",{action:"on",wemoDevice:d},function(){console.log("emit callback")})},a.turnOff=function(){a.alerts=[],c.emit("wemo",{action:"off",wemoDevice:d},function(){console.log("emit callback")})},a.cancel=function(){b.dismiss("cancel")}}];angular.module("interDromeApp").controller("BleepCtrl",["$scope","Bleep","$modal","$log","idSocket","Beacon","Notification","$filter","HueLight","Wemo","BleepAction",function(a,b,c,d,e,f,g,h,i,j,k){function l(c){if("undefined"!=typeof a.bleepData.bleeps){for(var d=a.bleepData.bleeps,e=0;e<d.length;e++)if(console.log("Does "+d[e].address+" equal "+c.bleep.address),d[e].address===c.bleep.address)return a.bleepData.bleeps[e].beacons=c.bleep.beacons,void a.$digest()}else a.bleepData=b.get()}function m(b){a.selectedBeacon.name=b.name}function n(a){return a.indexOf(a+"'s")<0?a+"'s":a}function o(b){if(a.bleepActions=[],"undefined"!=typeof b&&"undefined"!=typeof b.bleep&&"undefined"!=typeof b.bleep.actions)for(var c=b.bleep.actions,d=0;d<c.length;d++){var e=c[d];a.inserted={_id:e._id,bleep:a.selectedBleep._id,event_type:e.event_type,action_type:e.action_type,notification:e.pushover_user||e.email,control_type:e.control_type,hue_light:e.hue_light?e.hue_light._id:void 0,wemo_device:e.wemo_device?e.wemo_device._id:void 0},a.bleepActions.push(a.inserted)}}function p(b){if(a.notifications=[],"undefined"!=typeof b&&"undefined"!=typeof b.data)for(var c=0;c<b.data.length;c++){b.data[c].email&&a.notifications.push({value:b.data[c].email,text:b.data[c].email}),b.data[c].pushover_user&&a.notifications.push({value:b.data[c].pushover_user,text:n(b.data[c].name)+" Pushover"})}}function q(b){if(a.hueLights=[],console.log("Hue Lights Data "+JSON.stringify(b)),"undefined"!=typeof b&&"undefined"!=typeof b.data)for(var c=0;c<b.data.length;c++)a.hueLights.push({value:b.data[c]._id,text:b.data[c].name})}function r(b){if(a.wemoLights=[],console.log("Wemo Data "+JSON.stringify(b)),"undefined"!=typeof b&&"undefined"!=typeof b.devices)for(var c=0;c<b.devices.length;c++)a.wemoLights.push({value:b.devices[c]._id,text:b.devices[c].friendlyName})}function s(a,b){"undefined"!=typeof a&&a&&(a.indexOf("@")>0?b.email=a:b.pushover_user=a)}a.bleepData=b.get(),a.selectedBleep,a.selectedBeacon,a.notificationData=g.get(p),a.hueLightData=i.get(q),a.wemoData=j.get(r);var t;a.$on("socket:bleep-enter",function(a,b){b.err||(console.log("BLEEP Enter"),l(b))}),a.$on("socket:bleep-exit",function(a,b){b.err||(console.log("BLEEP Exit"),l(b))}),a.editBleep=function(c){a.selectedBleep=c,b.get({id:a.selectedBleep._id},o)},a.itemClass=function(b){return b===a.selectedBleep?"list-group-item active":"list-group-item"},a.beaconItemClass=function(b){return b===a.selectedBeacon?"list-group-item active":"list-group-item"},a.showBeacon=function(b){a.selectedBeacon=b,"undefined"==typeof t&&(t=c.open({templateUrl:"bleep-beacon-modal-content",controller:BleepBeaconModalInstanceCtrl,resolve:{selectedBeacon:function(){return a.selectedBeacon},socket:function(){return e},beacon:function(){return f},beaconChange:function(){return m}}}),t.result.then(function(){},function(){t=void 0,d.info("Modal dismissed at: "+new Date)}))},a.eventTypes=[{value:"enter",text:"enter"},{value:"exit",text:"exit"}],a.actionTypes=[{value:"notify",text:"notify"},{value:"turn on",text:"turn on"},{value:"turn off",text:"turn off"}],a.controlTypes=[{value:"Philips Hue",text:"Philips Hue"},{value:"Wemo",text:"Wemo"}],a.newAction=function(){console.log("New Action"),a.inserted={bleep:a.selectedBleep._id,event_type:null,action_type:null,notification:null,control_type:null,hue_light:null,wemo_device:null},a.bleepActions.push(a.inserted),console.log("BLEEP Actions "+JSON.stringify(a.bleepActions))},a.notificationName=function(b){var c=[];return b.notification&&(c=h("filter")(a.notifications,{value:b.notification})),c.length?c[0].text:"Notification"},a.hueLightName=function(b){var c=[];return b.hue_light&&(c=h("filter")(a.hueLights,{value:b.hue_light})),c.length?c[0].text:"Light"},a.wemoLightName=function(b){var c=[];return b.wemo_device&&(c=h("filter")(a.wemoLights,{value:b.wemo_device})),c.length?c[0].text:"Light"},a.saveBleep=function(){for(var c=0;c<a.bleepActions.length;c++)"undefined"!=typeof a.bleepActions[c]._id?(s(a.bleepActions[c].notification,a.bleepActions[c]),k.update({id:a.bleepActions[c]._id},a.bleepActions[c])):(s(a.bleepActions[c].notification,a.bleepActions[c]),console.log(JSON.stringify(a.bleepActions[c])),k.save(a.bleepActions[c]));b.update({id:a.selectedBleep._id},{name:a.selectedBleep.name}),a.selectedBleep=null}}]);var BleepBeaconModalInstanceCtrl=["$scope","$modalInstance","selectedBeacon","Beacon","beaconChange",function(a,b,c,d,e){a.selectedBeacon=JSON.parse(JSON.stringify(c)),a.selectedBeaconRef=JSON.parse(JSON.stringify(c)),a.beaconChanged=!1,a.setBeaconChanged=function(){a.beaconChanged=a.selectedBeacon.name!==a.selectedBeaconRef.name?!0:!1},a.close=function(){b.dismiss("cancel")},a.save=function(){d.update({id:c._id,name:a.selectedBeacon.name}),a.selectedBeaconRef=JSON.parse(JSON.stringify(c)),a.beaconChanged=!1,e(a.selectedBeacon)}}];angular.module("interDromeApp").controller("EventCtrl",["$scope","$http","idSocket",function(a,b){a.filterOptions={filterText:"",useExternalFilter:!0},a.totalServerItems=0,a.pagingOptions={pageSizes:[250,500,1e3],pageSize:250,currentPage:1},a.$on("socket:bleep-enter",function(b,c){c.err||a.getPagedDataAsync(a.pagingOptions.pageSize,a.pagingOptions.currentPage)}),a.$on("socket:bleep-exit",function(b,c){c.err||a.getPagedDataAsync(a.pagingOptions.pageSize,a.pagingOptions.currentPage)}),a.setPagingData=function(b,c,d){var e=b.slice((c-1)*d,c*d);a.bleepEventsData=e,a.totalServerItems=b.length,a.$$phase||a.$apply()},a.getPagedDataAsync=function(c,d,e){setTimeout(function(){var f;if(e){var g=e.toLowerCase();b.get("api/bleep/events").success(function(b){f=b.filter(function(a){return-1!=JSON.stringify(a).toLowerCase().indexOf(g)}),a.setPagingData(f,d,c)})}else b.get("api/bleep/events").success(function(b){a.setPagingData(b,d,c)})},100)},a.formatDate=function(a){var b=new Date(a),c=b.getMonth()+1,d=b.getHours(),e=b.getMinutes(),f=b.getSeconds(),g="AM",h=d;h>=12&&(h=d-12,g="PM"),0==h&&(h=12),h=10>h?"0"+h:h,e=10>e?"0"+e:e,f=10>f?"0"+f:f,c=10>c?"0"+c:c;var i=c+"/"+b.getDate()+"/"+b.getFullYear();return i+=" "+h+":"+e+":"+f+" "+g},a.getPagedDataAsync(a.pagingOptions.pageSize,a.pagingOptions.currentPage),a.$watch("pagingOptions",function(b,c){b!==c&&b.currentPage!==c.currentPage&&a.getPagedDataAsync(a.pagingOptions.pageSize,a.pagingOptions.currentPage,a.filterOptions.filterText)},!0),a.$watch("filterOptions",function(b,c){b!==c&&a.getPagedDataAsync(a.pagingOptions.pageSize,a.pagingOptions.currentPage,a.filterOptions.filterText)},!0),a.gridOptions={data:"bleepEventsData",enablePaging:!0,showFooter:!0,totalServerItems:"totalServerItems",pagingOptions:a.pagingOptions,filterOptions:a.filterOptions,multiSelect:!1,columnDefs:[{field:"created",displayName:"Created",cellTemplate:'<div class="ngCellText">{{formatDate(row.getProperty(col.field))}}</div>'},{field:"event",displayName:"Event"},{field:"bleep.name",displayName:"BLEEP"},{field:"beacon.name",displayName:"Beacon"}],sortInfo:{fields:["created"],directions:["desc"]}}}]),angular.module("interDromeApp").controller("NotificationCtrl",["$scope","Notification","BootstrapGrowl",function(a,b,c){function d(){a.alerts=[],a.alerts.push({type:"warning",msg:"Note: Email requires additional setup. Check the Settings Tab above."})}a.notifications=b.get(),a.notification,a.alerts=[];var e={ele:"#notification-bootstrap-growl"};a.closeAlert=function(b){a.alerts.splice(b,1)},a.create=function(){a.notification={},d()},a.edit=function(b){a.notification=b},a.cancel=function(){a.notification=void 0},a.itemClass=function(b){return b===a.notification?"list-group-item active":"list-group-item"},a.save=function(){console.log("Saving Notification"),console.log(a.notification),"undefined"!=typeof a.notification._id?b.update({id:a.notification._id},a.notification,function(){c.success("Notification Saved.",e),a.notification=void 0},function(a){c.error("Error saving Notification; "+a,e)}):b.save(a.notification,function(){c.success("Notification Saved.",e),a.notification=void 0},function(a){c.error("Error saving Notification; "+a,e)})}}]),angular.module("interDromeApp").factory("Auth",["$location","$rootScope","Session","User","$cookieStore",function(a,b,c,d,e){return b.currentUser=e.get("user")||null,e.remove("user"),{login:function(a,d){var e=d||angular.noop;return c.save({email:a.email,password:a.password},function(a){return b.currentUser=a,e()},function(a){return e(a)}).$promise},logout:function(a){var d=a||angular.noop;return c.delete(function(){return b.currentUser=null,d()},function(a){return d(a)}).$promise},createUser:function(a,c){var e=c||angular.noop;return d.save(a,function(a){return b.currentUser=a,e(a)},function(a){return e(a)}).$promise},changePassword:function(a,b,c){var e=c||angular.noop;return d.update({oldPassword:a,newPassword:b},function(a){return e(a)},function(a){return e(a)}).$promise},currentUser:function(){return d.get()},adminUser:function(){var a=d.get();return a},isLoggedIn:function(){var a=b.currentUser;return!!a}}}]),angular.module("interDromeApp").factory("Session",["$resource",function(a){return a("/api/session/")}]),angular.module("interDromeApp").factory("User",["$resource",function(a){return a("/api/users/:id",{id:"@id"},{update:{method:"PUT",params:{}},get:{method:"GET",params:{id:"me"}}})}]),angular.module("interDromeApp").factory("HueBridge",["$resource",function(a){return a("/api/hue/bridges",{},{update:{method:"PUT",params:{id:"@id",name:"@name"}},get:{method:"GET",params:{}}})}]),angular.module("interDromeApp").factory("Bleep",["$resource",function(a){return a("/api/bleeps/:id",{id:"@id"},{update:{method:"PUT",params:{id:"@id",name:"@name",location:"@location",interZone:"@interZone"}},get:{method:"GET",params:{}}})}]),angular.module("interDromeApp").factory("Wemo",["$resource",function(a){return a("/api/wemos/:id",{id:"@id"},{update:{method:"PUT",params:{}},get:{method:"GET",params:{}}})}]),angular.module("interDromeApp").factory("Beacon",["$resource",function(a){return a("/api/beacons",{},{update:{method:"PUT",params:{id:"@id",name:"@name"}},get:{method:"GET",params:{}}})}]),angular.module("interDromeApp").factory("Notification",["$resource",function(a){return a("/api/notifications/:id",{id:"@id"},{update:{method:"PUT",params:{name:"@name",pushover_user:"@pushover_user",email:"@email"}},get:{method:"GET",params:{}}})}]),angular.module("interDromeApp").factory("InterZone",["$resource",function(a){return a("/api/interzones/:id",{id:"@id"},{update:{method:"PUT",params:{name:"@name",loc:"@loc",points:"@points",angle:"@angle",pan:"@pan",zoom:"@zoom",default_zone:"@default_zone",bleeps:"@bleeps"}},get:{method:"GET",params:{}}})}]),angular.module("interDromeApp").factory("BootstrapGrowl",["$rootScope",function(){function a(a,b,c){"undefined"==typeof c&&(c={}),c.type=b,$(document).ready(function(){$.bootstrapGrowl(a,c)})}return{info:function(b,c){a(b,"info",c)},error:function(b,c){a(b,"danger",c)},success:function(b,c){a(b,"success",c)}}}]),angular.module("interDromeApp").factory("HueLight",["$resource",function(a){return a("/api/hue/lights/:id",{id:"@id"},{update:{method:"PUT",params:{light_id:"@light_id",name:"@name",bridge:"@bridge"}},get:{method:"GET",params:{}}})}]),angular.module("interDromeApp").factory("BleepAction",["$resource",function(a){return a("/api/bleep/actions/:id",{id:"@id"},{update:{method:"PUT",params:{bleep:"@bleep",hue_light:"@hue_light",wemo_device:"@wemo_device",pushover_user:"@pushover_user",email:"@email",event_type:"@event_type",action_type:"@action_type",control_type:"@control_type"}},get:{method:"GET",params:{}}})}]),angular.module("interDromeApp").directive("mongooseError",function(){return{restrict:"A",require:"ngModel",link:function(a,b,c,d){b.on("keydown",function(){return d.$setValidity("mongoose",!0)})}}}),angular.module("interDromeApp").directive("a",function(){return{restrict:"E",link:function(a,b,c){if(c.ngClick||""===c.href||"#"===c.href){var d=$(b[0]).attr("class");("undefined"==typeof d||"undefined"!=typeof d&&d.indexOf("accordion-toggle")<0)&&b.on("click",function(b){b.preventDefault(),c.ngClick&&a.$eval(c.ngClick)})}}}}),angular.module("interDromeApp").directive("donutChart",function(){function a(a,b){var c=d3.scale.category10(),d=[10,20,30],e=300,f=300,g=Math.min(e,f),h=d3.select(b[0]).append("svg"),i=d3.layout.pie().sort(null),j=d3.svg.arc().outerRadius(g/2*.9).innerRadius(g/2*.5);h.attr({width:e,height:f});var k=h.append("g").attr("transform","translate("+e/2+","+f/2+")");k.selectAll("path").data(i(d)).enter().append("path").style("stroke","white").attr("d",j).attr("fill",function(a,b){return c(b)})}return{link:a,restrict:"E"}}),angular.module("interDromeApp").directive("interzoneEditor",["$rootScope",function(a){function b(){i.select("path").attr("d",l);var c=i.selectAll("circle").data(m,function(a){return a});c.enter().append("circle").attr("r",1e-6).on("mousedown",function(a){k=j=a,b()}).transition().duration(750).ease("elastic").attr("r",6.5),c.classed("selected",function(a){return a===k}).attr("cx",function(a){return a[0]}).attr("cy",function(a){return a[1]}),c.exit().remove(),d3.event&&(d3.event.preventDefault(),d3.event.stopPropagation()),a.$$phase||n.$$phase||n.$apply()}function c(){l.interpolate(this.value),b()}function d(){m.push(k=j=d3.mouse(i.node())),b()}function e(){if(j){var a=d3.mouse(i.node());j[0]=Math.max(0,Math.min(o,a[0])),j[1]=Math.max(0,Math.min(p,a[1])),b()}}function f(){j&&(e(),j=null)}function g(a,g){o=a.width,p=a.height,j=null,k=m[0],l=d3.svg.line(),i=d3.select(g[0]).append("svg").attr("width",o).attr("height",p).attr("tabindex",1),i.append("rect").attr("width",o).attr("height",p).on("mousedown",d),i.append("path").datum(m).attr("class","line").call(b),d3.select(window).on("mousemove",e).on("mouseup",f),d3.select("#interpolate").on("change",c).selectAll("option").data(["linear","step-before","step-after","basis","basis-open","basis-closed","cardinal","cardinal-open","cardinal-closed","monotone"]).enter().append("option").attr("value",function(a){return a}).text(function(a){return a}),i.node().focus()}function h(a,c,d){n=a,m=a.points,a.internalControl=a.control||{},a.internalControl.reset=function(e){d3.select(c[0]).selectAll("svg").remove(),m=e,g(a,c,d),b()},a.internalControl.clear=function(){for(var a=0;a<m.length;a++)m.splice(a,1),k=m.length?m[a>0?a-1:0]:null;m.length>=0&&b()},g(a,c,d),a.internalControl.ready()}var i,j,k,l,m,n,o=960,p=500;return{link:h,restrict:"E",scope:{width:"=",height:"=",points:"=",control:"="}}}]),angular.module("interDromeApp").directive("interzone",["$rootScope",function(a){function b(){f.select("path").attr("d",g),d3.event&&(d3.event.preventDefault(),d3.event.stopPropagation()),a.$$phase||i.$$phase||i.$apply()}function c(){}function d(a,d){console.log("Creating D3 Interzone SVG Map"),c(),g=d3.svg.line(),f=d3.select(d[0]).append("svg").attr("width",j).attr("height",k).attr("tabindex",1),f.append("rect").attr("width",j).attr("height",k),f.append("path").datum(h).attr("class","line").call(b),d3.select("#interpolate").selectAll("option").data(["linear","step-before","step-after","basis","basis-open","basis-closed","cardinal","cardinal-open","cardinal-closed","monotone"]).enter().append("option").attr("value",function(a){return a
}).text(function(a){return a}),f.node().focus()}function e(a,c,e){i=a,j=a.width,k=a.height,h=a.points,a.internalControl=a.control||{},a.internalControl.reset=function(f){console.log("reset called"),d3.select(c[0]).selectAll("svg").remove(),h=f,d(a,c,e),b()},d(a,c,e)}var f,g,h,i,j=960,k=500;return{link:e,restrict:"E",scope:{width:"=",height:"=",points:"=",control:"="}}}]),angular.module("interDromeApp").directive("interzoneDragZoom",["$rootScope","$location",function(a,b){function c(a,b){var c=new Date(a),d=c.getMonth()+1,e=c.getHours(),f=c.getMinutes(),g=c.getSeconds(),h="AM",i=e;i>=12&&(i=e-12,h="PM"),0==i&&(i=12),i=10>i?"0"+i:i,f=10>f?"0"+f:f,g=10>g?"0"+g:g,d=10>d?"0"+d:d;var j=d+"/"+c.getDate()+"/"+c.getFullYear();return j+=b?" <span style='margin-left:3px'>"+i+"</span>:"+f+":"+g+" "+h:" "+i+":"+f+":"+g+" "+h}function d(a){var b=J[a].filter,c=1,d=!0,e=0;b.attr("stdDeviation",.2),"undefined"!=typeof J[a].interval&&clearInterval(J[a].interval),J[a].interval=setInterval(function(){d?b.attr("stdDeviation",(c+=5)/5):b.attr("stdDeviation",(c-=5)/5),c>=50?(d=!1,e+=1):5>=c&&(d=!0),e>=3&&d&&(clearInterval(J[a].interval),b.attr("stdDeviation",0))},90)}function e(a){var b=J[a].filter;b.attr("stdDeviation",.2),"undefined"!=typeof J[a].interval&&clearInterval(J[a].interval)}function f(){A.select("path").attr("d",D),d3.event&&(d3.event.preventDefault(),d3.event.stopPropagation()),a.$$phase||F.$$phase||F.$apply()}function g(){d3.event.sourceEvent.srcElement.classList;F.pan=d3.event.translate,F.zoom=d3.event.scale,a.$$phase||F.$$phase||F.$apply(),h(F.pan,F.zoom)}function h(a,b){B.attr("transform","translate("+a+")scale("+b+")")}function i(a){var b=a.node(),c=b.getBBox();return[c.x+c.width/2,c.y+c.height/2]}function j(a){H=G.select("#interzone-floor-plan").transform("r"+a)}function k(c){var e=i(C);if(console.log("InterZone Center "+JSON.stringify(e)),"undefined"==typeof c.location&&(c.location={}),c.location.x=c.location.x||e[0],c.location.y=c.location.y||e[1],!(c._id in J)){var f=A.select("defs").append("filter").attr("id","blur-"+c._id).attr("filterUnits","userSpaceOnUse").append("feGaussianBlur").attr("in","SourceGraphic").attr("stdDeviation",1);J[c._id]={},J[c._id].filter=f}c._id in I&&delete I[c._id];var g=C.append("g").attr("id",c._id).data([{x:c.location.x,y:c.location.y}]);g.append("circle").attr("class",c._id).attr("cx",function(a){return a.x}).attr("cy",function(a){return a.y}).attr("r",K).attr("style","fill:darkred;stroke:darkred;stroke-width:.5;fill-opacity:1;").attr("filter","url("+b.path()+"#blur-"+c._id+")");var h=g.append("circle").attr("id","bleep-"+c._id).attr("class","bleep").attr("cx",function(a){return a.x}).attr("cy",function(a){return a.y}).attr("r",K).attr("cursor","move").attr("style","fill:red;stroke:white;fill-opacity:1;stroke-width:1;").attr("data-container","body").attr("data-toggle","popover").attr("data-placement","right").attr("data-content",c.name).call(d3.behavior.drag().origin(function(a){return a}).on("dragstart",function(){d3.event.sourceEvent.stopPropagation(),d3.select(this).classed("dragging",!0),$("#bleep-"+c._id).popover("hide")}).on("drag",function(b){$("#bleep-"+c._id).popover("hide"),c.location.x=Math.max(K,Math.min(x-K,d3.event.x)),c.location.y=Math.max(K,Math.min(y-K,d3.event.y)),a.$$phase||F.$$phase||F.$apply(),d3.select($("#"+c._id)[0]).selectAll("circle").attr("cx",b.x=c.location.x).attr("cy",b.y=c.location.y)}).on("dragend",function(){d3.select(this).classed("dragging",!1),d(c._id);var a=l(c._id);F.internalControl.bleepChange(a),m(a)})).on("mouseover",function(){d3.event.preventDefault(),$("#bleep-"+c._id).popover("show")}).on("mouseout",function(){d3.event.preventDefault(),$("#bleep-"+c._id).popover("hide")});I[c._id]={sphere:h,rsmall:{},rmedium:{},rlarge:{}},d(c._id)}function l(a){for(var b=0;b<F.bleeps.length;b++)if(F.bleeps[b]._id===a)return F.bleeps[b]}function m(a,b,c){i(I[a._id].sphere);"undefined"==typeof b&&(b=0),console.log("Add Beacons "+JSON.stringify(a)),r(a);for(var d=(C.append("g").attr("id","beacons-"+a._id).attr("class","beacons"),0);d<a.beacons.length;d++){var e=a.beacons[d]._id,f=n(a,a.beacons[d]),g=A.select("#beacon-circle-group-"+e).append("g").attr("transform","translate("+[f.x,f.y]+")");if(g.append("rect").attr("id","beacon-"+e).attr("class",".beacon").attr("x",0).attr("y",0).attr("width",5).attr("height",5).attr("style","fill:orange;stroke:white;stroke-width:1;").attr("data-container","body").attr("data-toggle","popover").attr("data-placement","bottom").attr("data-content",t(a.beacons[d])).attr("data-html","true").on("mouseover",function(){d3.event.preventDefault(),$(this).popover("show")}).on("mouseout",function(){d3.event.preventDefault(),$(this).popover("hide")}),"undefined"==typeof c||c!==!0){setTimeout(function(){$("#beacon-"+e).popover("show")},b);{setTimeout(function(){$("#beacon-"+e).popover("hide")},3500)}}}}function n(a,b){var c=i(I[a._id].sphere);console.log(c);var d=Math.PI,e=o(a,b),f=d3.svg.arc().innerRadius(e.r-2).outerRadius(e.r).startAngle(d/180).endAngle(7),g=C.select("#beacons-"+a._id).append("g").attr("id","beacon-circle-group-"+b._id).attr("transform","translate("+[c[0],c[1]]+")");g.append("path").attr("id","beacon-circle-"+b._id).attr("d",f).attr("style","fill:#111");var h=C.select("#beacon-circle-"+b._id).node(),j=h.getPointAtLength(q(a,b,e.rsize));return j}function o(a,b){var c=Math.abs(b.rssi);return console.log("RSSI "+c),70>c?(p(a,b,L),{r:15,rsize:L}):c>70&&80>c?(p(a,b,M),{r:25,rsize:M}):(p(a,b,N),{r:30,rsize:N})}function p(a,b,c){b._id in I[a._id][c]||(delete I[a._id][L][b._id],delete I[a._id][M][b._id],delete I[a._id][N][b._id],I[a._id][c][b._id]=void 0)}function q(a,b,c){var d=Object.keys(I[a._id][c]).length;return"undefined"==typeof I[a._id][c][b._id]&&(I[a._id][c][b._id]=1===d?0:d+5),console.log("BEACONS IN RSIZE "+Object.keys(I[a._id][c]).length),console.log("BEACON POS "+I[a._id][c][b._id]),I[a._id][c][b._id]}function r(a){s(a),C.selectAll("#beacons-"+a._id).remove()}function s(a){for(var b=0;b<a.beacons.length;b++)$("#beacon-"+a.beacons[b]._id).popover("hide")}function t(a){var b=a.name;return"undefined"!=typeof a.bleepEnter&&(b+=" <div><span style='margin-right:5px;'>Enter:</span> "+c(a.bleepEnter,!0)+"</div>"),b}function u(a,b){w={top:-5,right:-5,bottom:-5,left:-5},x=a.width-w.left-w.right,y=a.height-w.top-w.bottom,z=d3.behavior.zoom().scaleExtent([1,10]).on("zoom",g),A=d3.select(b[0]).append("svg").attr("id","interdrome-container").attr("width",x+w.left+w.right).attr("height",y+w.top+w.bottom).append("g").attr("transform","translate("+w.left+","+w.right+")").call(z).on("mousedown",function(){d3.event.preventDefault(),d3.select(this).classed("zooming",!0)}).on("mouseup",function(){d3.event.preventDefault(),d3.select(this).classed("zooming",!1)}),A.append("defs"),A.append("rect").attr("width",x).attr("height",y).style("fill","none").style("pointer-events","all"),B=A.append("g"),B.append("g").attr("class","x axis").selectAll("line").data(d3.range(0,x,10)).enter().append("line").attr("x1",function(a){return a}).attr("y1",0).attr("x2",function(a){return a}).attr("y2",y),B.append("g").attr("class","y axis").selectAll("line").data(d3.range(0,y,10)).enter().append("line").attr("x1",0).attr("y1",function(a){return a}).attr("x2",x).attr("y2",function(a){return a}),C=B.append("g").attr("id","interzone-floor-plan"),C.append("path").datum(E).attr("class","interzone-line").call(f),G=Snap("#interdrome-container"),j(a.angle),d3.select("#interpolate").selectAll("option").data(["linear","step-before","step-after","basis","basis-open","basis-closed","cardinal","cardinal-open","cardinal-closed","monotone"]).enter().append("option").attr("value",function(a){return a}).text(function(a){return a}),h(F.pan,F.zoom),a.$watch("angle",function(){"number"==typeof a.angle&&j(a.angle)},!0),a.$watch("zoom",function(){h(F.pan,F.zoom)},!0)}function v(a,b,c){F=a,E=a.points,D=d3.svg.line(),a.internalControl=a.control||{},a.internalControl.clear=function(){},a.internalControl.addBleep=function(a){F.bleeps.push(a),k(a)},a.internalControl.reset=function(d){if(d3.select(b[0]).selectAll("svg").remove(),E=d,u(a,b,c),f(),"undefined"!=typeof F.bleeps)for(var e=0;e<F.bleeps.length;e++)k(F.bleeps[e]),m(F.bleeps[e],500)},a.internalControl.bleepUpdate=function(a,b,c){d(a._id),c?m(a):m(a,0,!0)},a.internalControl.beaconInfo=function(a){m(a,0,!0)},a.internalControl.selectBeacon=function(a,b){d(b._id),$("#beacon-"+a._id).popover("show")},a.internalControl.resetSelectedBeacon=function(a,b){e(b._id),$("#beacon-"+a._id).popover("hide")},u(a,b,c),a.internalControl.ready()}var w,x,y,z,A,B,C,D,E,F,G,H,I={},J={},K=5,L="rsmall",M="rmedium",N="rlarge";return{link:v,restrict:"E",scope:{width:"=",height:"=",points:"=",control:"=",angle:"=",pan:"=",zoom:"=",bleeps:"="}}}]),angular.module("interDromeApp").directive("bootstrapSlider",["$rootScope","$parse",function(a,b){var c=!1;return{restrict:"E",replace:!0,template:'<input type="text" />',link:function(d,e,f){var g=b(f.model);if(void 0!==typeof f.handle)var h=$(e[0]).slider({handle:f.handle,value:f.bootstrapSliderValue});else var h=$(e[0]).slider();h.on("slide",function(a){"number"==typeof a.value&&(g.assign(d,a.value),d.$apply())}),h.on("slideStart",function(){c=!0}),h.on("slideStop",function(){c=!1}),d.$watch(f.model,function(b){var d=setTimeout(function(){a.$$phase||"number"!=typeof b||c||(h.slider("setValue",b),clearInterval(d))},100)},!0)}}}]);